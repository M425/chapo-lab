all:
  vars:
    # --- PROXMOX CONFIG ---
    pve_host: 192.168.178.225
    pve_user: "root@pam"
    pve_password: "chapo"
    pve_node: "server"
    pve_iso_storage: "local"
    pve_storage: "local-lvm"
    pve_storage_source: "local" # Where we download the image (must support 'import')
    pve_storage_dest: "local-lvm" # Where the VM disk effectively lives
    pve_bridge: "vmbr1"

    # --- TEMPLATE CONFIG ---
    template_id: 9000
    template_name: "ubuntu-minimal-template"
    image_url: "https://cloud-images.ubuntu.com/minimal/releases/jammy/release/ubuntu-22.04-minimal-cloudimg-amd64.img"
    image_filename: "ubuntu-22.04-minimal.img"
    image_path: "/var/lib/vz/template/iso"

    # --- OBSERVABILITY CONFIG ---
    loki_url: "http://observability.chapo.casa:3100/loki/api/v1/push"
    prometheus_url: "http://observability.chapo.casa:9090/api/v1/write"

    # --- CONNECTION CONFIG ---
    ssh_key_pub: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPsnyip4GXugAf+n7RCwamBIWiY5exnEaKLfhK4mYxj+ mat@mat-win-lap"

    # --- GENERAL CONFIG ---
    timezone: "Europe/Rome"

  children:
    # Group for the Proxmox Hypervisor API
    pves:
      hosts:
        server:
          os_type: pve
          ansible_host: 192.168.178.225  # IP of your Proxmox server
          ansible_user: root
          node_name: server
          nic_ip_cidr: "192.168.178.225/24"


    # Group for the target Docker VM
    ubuntu:
      vars:
        os_type: ubuntu
        ansible_user: ubuntu
        nic_gateway: "192.168.179.1"
        nic_subnet: "/24"
        nic_bridge: vmbr1
        admin_users: []
        docker_users: ['ubuntu']
        ufw_allowed_ports: []
        enable_auto_updates: true

      hosts:

        media:
          vm_name: media
          vm_id: 500
          vm_cores: 2
          vm_memory_mb: 2048
          vm_disk_gb: 40
          swap_size_mb: 2048
          ansible_host: 192.168.179.21
          nfs_mounts:
            - src: 192.168.179.20:/confs
              dest: /confs
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
  
        qbittorrent:
          vm_name: qbittorrent
          vm_id: 501
          vm_cores: 2
          vm_memory_mb: 2048
          vm_disk_gb: 40
          swap_size_mb: 2048
          ansible_host: 192.168.179.22
          nfs_mounts:
            - src: 192.168.179.20:/confs
              dest: /confs
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
  
        observability:
          vm_name: observability
          vm_id: 502
          vm_cores: 2
          vm_memory_mb: 2048
          vm_disk_gb: 40
          swap_size_mb: 2048
          ansible_host: 192.168.179.24
          nfs_mounts:
            - src: 192.168.179.20:/confs
              dest: /confs
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
            - src: 192.168.179.20:/data-prometheus
              dest: /data-prometheus
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
            - src: 192.168.179.20:/data-grafana
              dest: /data-grafana
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
            - src: 192.168.179.20:/data-loki
              dest: /data-loki
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
          svcs:
            - name: grafstack
            - name: pvemon
              
        core:
          vm_name: core
          vm_id: 503
          vm_cores: 2
          vm_memory_mb: 2048
          vm_disk_gb: 40
          swap_size_mb: 2048
          ansible_host: 192.168.179.23
          nfs_mounts:
            - src: 192.168.179.20:/confs
              dest: /confs
              opts: rw,_netdev,sync,hard,intr,timeo=500,retrans=5
          svcs: []

    appliance:
      vars:
        os_type: appliance
        nic_subnet: "/24"
        ansible_user: root

      hosts:

        opnsense:
          vm_name: opnsense
          vm_id: 101
          ansible_host: 192.168.179.1

        openmediavault:
          vm_name: openmediavault
          vm_id: 100
          ansible_host: 192.168.179.20
          ansible_user: root
          
